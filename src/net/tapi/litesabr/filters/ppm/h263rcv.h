/////////////////////////////////////////////////////////////////////////////
//  INTEL Corporation Proprietary Information
//  This listing is supplied under the terms of a license agreement with Intel 
//  Corporation and many not be copied nor disclosed except in accordance
//  with the terms of that agreement.
//  Copyright (c) 1995, 1996 Intel Corporation. 
//
//
//  Module Name: h263rcv.h
//	Environment: MSVC 4.0, OLE 2
/////////////////////////////////////////////////////////////////////////////////

// $Header:   J:\rtp\src\ppm\h263rcv.h_v   1.12   04 Mar 1997 19:54:54   lscline  $

#ifndef H263RCV_H
#define H263RCV_H

#include "ppmrcv.h"
#include "ppmclsid.h"
#include "h263.h"
#include "freelist.h"

//lsc - need to adjust size?
#define H263_BUFFER_SIZE 20000

class H263_ppmReceive : public ppmReceive
{

unsigned char	m_lastMBAP;
unsigned char	m_lastQuant;
unsigned char	m_lastGOBN; 
char			m_lastVMV;
char			m_lastHMV;
BOOL			m_GlobalLastMarkerBitIn;

#ifdef REBUILD_EXBITSTREAM
BOOL            m_ExtendedBitstream;
HRESULT			BuildExtendedBitstream(MsgHeader* const pMsgHdr);
#endif

FreeList        *m_pH263Headers;

public:

H263_ppmReceive(IUnknown* pUnkOuter, IUnknown** ppUnkInner);
~H263_ppmReceive();

DECLARE_CREATEPROC()

STDMETHODIMP_( const CLSID& ) GetCLSID( void ) const {return CLSID_H263PPMReceive;}

STDMETHODIMP QueryInterface( REFIID riid, LPVOID FAR* ppvObj )
{return CUnknown::QueryInterface(riid, ppvObj);}

STDMETHODIMP GetInterface( REFIID riid, LPVOID FAR* ppvObj )
{return ppmReceive::GetInterface( riid, ppvObj );}

STDMETHODIMP_( ULONG )AddRef( void )
{return CUnknown::AddRef();}

STDMETHODIMP_( ULONG )Release( void )
{return CUnknown::Release();}

//////////////////////////////////////////////////////////////////////////////
//ppmReceive Functions (Overrides)
//////////////////////////////////////////////////////////////////////////////

#ifdef REBUILD_EXBITSTREAM
//////////////////////////////////////////////////////////////////////////////////////////
//SetSession: Argument type is actually H26XPPMSESSPARAM_T
//////////////////////////////////////////////////////////////////////////////////////////
STDMETHOD(SetSession)(THIS_ PPMSESSPARAM_T *pSessparam);

//////////////////////////////////////////////////////////////////////////////
//   IPPMReceiveSession Functions (Overrides)
STDMETHOD(GetResiliency)(THIS_ LPBOOL			lpbResiliency);
STDMETHOD(SetResiliency)(THIS_ BOOL			pbResiliency);
#else
//Default to ppmReceive::SetSession() and ppmReceive::<IPPMReceiveSession> fns
#endif

//////////////////////////////////////////////////////////////////////////////////////////
//TimeToProcessMessages:
//////////////////////////////////////////////////////////////////////////////////////////
virtual BOOL TimeToProcessMessages(FragDescriptor *pFragDescrip, MsgHeader *pMsgHdr);
 
//////////////////////////////////////////////////////////////////////////////////////////
//CheckMessageComplete: 
//////////////////////////////////////////////////////////////////////////////////////////
virtual BOOL CheckMessageComplete(MsgHeader *pMsgHdr); 

//////////////////////////////////////////////////////////////////////////////////////////
//PrepMessage: Sets H263 global variables, calls base PrepMessage
//////////////////////////////////////////////////////////////////////////////////////////
virtual HRESULT PrepMessage(BOOL); 

//////////////////////////////////////////////////////////////////////////////////////////
//DataCopy: Copies data fragments into client's buffer 
//////////////////////////////////////////////////////////////////////////////////////////
virtual HRESULT DataCopy(MsgHeader * const pMsgHdr);    

//////////////////////////////////////////////////////////////////////////////////////////
//PartialMessageHandler: deals with partial messages
//////////////////////////////////////////////////////////////////////////////////////////
virtual HRESULT PartialMessageHandler(MsgHeader *pMsgHdr);
//////////////////////////////////////////////////////////////////////////////////////////

//InitProfileHeader: Given a buffer as type void, sets up a profile header.  
//////////////////////////////////////////////////////////////////////////////////////////
virtual void *InitProfileHeader(void *pBuffer);

//////////////////////////////////////////////////////////////////////////////////////////
//FreeProfileHeader: Given a buffer as type void, frees up a profile header.  
//////////////////////////////////////////////////////////////////////////////////////////
virtual void FreeProfileHeader(void *pBuffer);

////////////////////////////////////////////////////////////////////////////////////
// PPM Functions (Overrides)
////////////////////////////////////////////////////////////////////////////////////
virtual int ReadProfileHeaderSize(void *pProfileHeader = NULL);


};  // Parameters to ppmReceive -> H263 Payload type, size of payload header, outer arg, inner arg

#endif

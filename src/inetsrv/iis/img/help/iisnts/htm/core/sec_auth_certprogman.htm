<html xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:myScript="http://iisue">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-16">
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1252">
<meta http-equiv="PICS-Label" content="(PICS-1.1 &quot;<http://www.rsac.org/ratingsv01.html>&quot; l comment &quot;RSACi North America Server&quot; by &quot;inet@microsoft.com <mailto:inet@microsoft.com>&quot; r (n 0 s 0 v 0 l 0))">
<meta name="MS.LOCALE" content="EN-US">
<meta name="MS-IT-LOC" content="Internet Information Services">
<meta name="MS-HAID" content="IIS_WMI_Object_Hierarchy">
<meta name="description" content="Describes the WMI object hierarchy">
<title>IIS WMI Object Hierarchy</title><SCRIPT LANGUAGE="JScript" SRC="iishelp.js"></SCRIPT></head>
<body>
<p style="color:red">[This is preliminary documentation and subject to change]</p>
<h1>IIS WMI Object Hierarchy</h1><a name="H1_37718888"></a><p>A new COM object, IISCertObj, allows you to use scripts to
manage certificates remotely and programmatically. With IISCertObj
you can:</p><ul><li>Import copies of a certificate from a pfx file (a file
containing a PFX-encrypted certificate and a private key) from a
server onto multiple servers.</li><li>Save backups of certificates on a central site.</li><li>Copy a certificate from one server onto multiple servers.</li></ul><p>This topic contains the following subjects:</p><div><ul><li><a href="sec_auth_certprogman.htm#implementation"><b>IISCertObj
Component Properties and Methods</b></a></li><li><a href="sec_auth_certprogman.htm#scenario"><b>Sample
Scripts</b></a></li></ul></div><p>To learn about obtaining SSL server certificates, see <a href="sec_auth_certobtainsrv.htm"><b>Obtaining a Server Certificate</b></a>.</p><h2><a name="implementation"></a>IISCertObj
Properties and Methods</h2><p>This section lists the IISCertObj properties and methods
supported in IIS 6.0.</p><h3>IISCertObj Properties</h3><p>Properties should be set before calling methods. Methods will
return an error message if the required properties for that method
are not available when the method is called.</p><p>The following properties are used to generate certificate
requests.</p><p><b>ServerName</b> </p><p>The <b>ServerName</b> property contains the name of the computer
on which certificate operations are executed.</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Attribute Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Attribute Value</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1">Data Type</td><td width="" height="" colspan="1" rowspan="1">String</td></tr></table><p><b>UserName</b> </p><p>The <b>UserName</b> property allows you to specify the username
used for logon to the remote machine. If <b>UserName</b> is empty,
the credentials of the currently logged on user are used. To
install a certificate into a remote certificate store, the user
must have administrator privileges on the remote machine.</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Attribute Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Attribute Value</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1">Data Type</td><td width="" height="" colspan="1" rowspan="1">String</td></tr></table><p><b>UserPassword</b> </p><p>The <b>UserPassword</b> property allows you to specify the
password used for logon to the remote machine.</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Attribute Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Attribute Value</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1">Data Type</td><td width="" height="" colspan="1" rowspan="1">String</td></tr></table><p><b>InstanceName</b> </p><p>The <b>InstanceName</b> property identifies the targeted
metabase instance.  W3svc/1 is an example.</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Attribute Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Attribute Value</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1">Data Type</td><td width="" height="" colspan="1" rowspan="1">String</td></tr></table><h3>IISCertObj Methods</h3><p><b>Export</b> </p><p>The <b>Export</b> method exports a copy of a certificate to a
file. The target file may be on the local computer or on a remote
computer.</p><p>    Export(FileName, Password, bPrivateKey,
bCertChain, bRemoveCert)</p><p>The <b>Export</b> method requires the following parameters:</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Data Type</b></td><td width="" height="" colspan="1" rowspan="1"><b>Description</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>FileName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Specifies the name of the targeted file. Example is
c:\mydir\mycert.pfx</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>Password</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Contains the password used to secure the file specified as <i>
Filename</i>.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>bPrivateKey</b></td><td width="" height="" colspan="1" rowspan="1">Boolean</td><td width="" height="" colspan="1" rowspan="1">Specifies that the private key is exported (true) or not
exported (false).</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>bCertChain</b></td><td width="" height="" colspan="1" rowspan="1">Boolean</td><td width="" height="" colspan="1" rowspan="1">Specifies that the certificate trust chain is to be exported
(true) or not exported (false).</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>bRemoveCert</b></td><td width="" height="" colspan="1" rowspan="1">Boolean</td><td width="" height="" colspan="1" rowspan="1">Specifies that the binding of a certificate will be removed
(true) or not removed (false).</td></tr></table><p><b>Import </b></p><p>The <b>Import</b> method imports a copy of a certificate from a
file to the local computer or a remote computer.</p><p>    Import(FileName, Password)</p><p>The Import method requires the following parameters:</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Data Type</b></td><td width="" height="" colspan="1" rowspan="1"><b>Description</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>FileName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Specifies the name of the certficate file to import.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>Password</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Contains the password used to secure the file specified as <i>
Filename</i>.</td></tr></table><p><b>Move</b> </p><p>The <b>Move</b> method allows you to move a certificate from one
instance of IIS to another, and from one computer to another.</p><p>Move (DestinationServerName, DestinationServerInstance,
DestinationServerUserName, DestinationServerPassword)</p><p>The <b>Move</b> method uses the following parameters:</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Data Type</b></td><td width="" height="" colspan="1" rowspan="1"><b>Description</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServerName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Identifies the servers to which the certificate will be
moved.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServer Instance</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Identifies the IIS metabase instance at which the certificate
will be pointed. Example is w3svc/1.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServerUserName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Optional username for the destination server. In empty, the
currently logged on username will be used.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServer Password</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Password for the destination server when
DestinationServerUserName is used.</td></tr></table><p><b>Copy</b> </p><p>The <b>Copy</b> method allows you to copy a certificate from one
instance of IIS to another, and from one computer to another.</p><p>Copy (DestinationServerName, DestinationServerInstance,
DestinationServerUserName, DestinationServerPassword)</p><p>The <b>Copy</b> method uses the following parameters:</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Data Type</b></td><td width="" height="" colspan="1" rowspan="1"><b>Description</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServerName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Identifies the servers to which the certificate will be
moved.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServer Instance</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Identifies the IIS metabase instance at which the certificate
will be pointed. Example is w3svc/1.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServerUserName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Optional username for the destination server. In empty, the
currently logged on username will be used.</td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>DestinationServer Password</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Password for the destination server when
DestinationServerUserName is used.</td></tr></table><p><b>IsInstalled</b> </p><p>The <b>IsInstalled</b> method allows you to determine whether or
not a certificate is installed on a computer specified by the
ServerName property.</p><p>IsInstalled(InstanceName)</p><p>The <b>IsInstalled</b> method uses the following parameters:</p><table width="100%" height=""><tr><td width="166" height="" colspan="1" rowspan="1"><b>Name</b></td><td width="" height="" colspan="1" rowspan="1"><b>Data Type</b></td><td width="" height="" colspan="1" rowspan="1"><b>Description</b></td></tr><tr><td width="166" height="" colspan="1" rowspan="1"><b>InstanceName</b></td><td width="" height="" colspan="1" rowspan="1">String</td><td width="" height="" colspan="1" rowspan="1">Identifies the IIS metabase instance to check for an installed
certificate. Example is w3svc/1.</td></tr></table><h2><a name="scenario"></a> Sample Scripts</h2><p>After acquiring a SSL server certificate from a certificate
authority, distributing copies to all the servers requires one or
more of  the following steps:</p><ul><li>Import copies of master certificates onto multiple
servers.</li><li>Save backup copies of certificates in a central archive.</li><li>Export certificates across multiple servers.</li></ul><p>In IIS 6.0, using Windows Script Host (WSH) or Activke SErver
Pages (ASP), you can execute scripts that communicate with
IISCertObj, programmatically importing, archiving, and exporting
certificates.</p><h3>Import Certificates to Multiple Servers (CertImport.VBS)</h3><p>Large sites often need to use one SSL certificate for secure
user logon to multiple servers. It would be very time-consuming to
use the MMC snap-in to add copies of the certificate to each
server. What you need is a scripted solution that installs copies
of the same certificate to all the targeted servers.</p><p>Save the following script as CertImport.vbs. Modify the
command-line statement arguments to match your network resources.
Then use the command-line statement to import a certificate from a
certificate store on one server to other servers that require
it.</p><pre><code>Option Explicit
 Dim iiscertobj, pfxfile, pfxfilepassword, InstanceName, WebFarmServers, IISServer
 Set iiscertobj = WScript.CreateObject("IIS.CertObj")
 pfxfile = WScript.Arguments(0)
 pfxfilepassword = WScript.Arguments(1)
 InstanceName = WScript.Arguments(2)
 WebFarmServers = split(WScript.Arguments(3), ",")
 iiscertobj.UserName = WScript.Arguments(4)
 iiscertobj.UserPassword = WScript.Arguments(5)
 For Each IISServer in WebFarmServers
   iiscertobj.ServerName = IISServer
   iiscertobj.InstanceName = InstanceName
   iiscertobj.Import pfxfile, InstanceName, pfxfilepassword
 Next
</code></pre><p>Command-line statement:</p><pre><code>Certimport.vbs cert.pfx pfxpassword w3svc/1 iisserver1,iisserver2,iisserver3 Administrator aal34290
</code></pre><h3>Save Certificates in a Central Archive
(Save_all_certs.vbs)</h3><p>Using the IISCertObj export method, you can archive a backup of
each certificate on your server farm to a central site.</p><p>Save the following script as Save_all_certs.vbs in your text
editor. Modify the command-line statement arguments to match your
network resources. Then use the command-line statement to export
copies of certificates to the central site.</p><pre><code>Option Explicit 
 Dim iiscertobj, targetServer, targetServers, pfxbasename, pfxpassword, InstanceName 
 Set iiscertobj = WScript.CreateObject("IIS.CertObj") 
 pfxbasename = WScript.Arguments(0) 
 pfxpassword = WScript.Arguments(1) 
 InstanceName = WScript.Arguments(2) 
 targetServers = split(WScript.Arguments(3), ",") 
 iiscertobj.UserName = WScript.Arguments(4) 
 iiscertobj.UserPassword = WScript.Arguments(5)
 iiscertobj.InstanceName = InstanceName
 For Each targetServer in targetServers 
   iiscertobj.ServerName = targetServer 
   iiscertobj.Export pfxbasename + targetServer + ".pfx", InstanceName, pfxpassword, true, false, false 
 Next
</code></pre><p>Command-line statement:</p><pre><code>Save_all_certs.vbs certbackup adsf-0324 w3svc/1 iisserver2,iisserver3,iisserver4 Administrator aal34290
</code></pre><h3>Copy a Certificate from an Existing Server to a New Server
(CertCopy.vbs)</h3><p>The script and command-line statement below will allow you to
use the copy method of  IISCertObj to copy a certificate to
the new server added to a server farm. </p><p>Save the script below as certcopy.vbs. Modify the command-line
statement arguments to match your network resources. Then run the
command-line statement.</p><pre><code>Dim iiscertobj, targetServer, targetServers, targetInstance
 Set iiscertobj = WScript.CreateObject("IIS.CertObj") 
 iiscertobj.ServerName = WScript.Arguments(0)
 iiscertobj.Instancename = WScript.Arguments(1)
 targetServers = split(WScript.Arguments(2), ",") 
 targetInstance = WScript.Arguments(3))
 iiscertobj.UserName = WScript.Arguments(4)
 iiscertobj.UserPassword = WScript.Arguments(5) 
 For Each targetServer in targetServers
   iiscertobj.Copy targetServer, targetInstance
 Next
</code></pre><p>Command-line statement:</p><pre><code>Certcopy.vbs iisServer1 w3svc/1 iisServer2 w3svc/1 Administrator asdf-0324</code></pre><hr class="iis" size="1">
<p align="center"><i><a href="/iishelp/common/colegal.htm">© 1997-2001 Microsoft Corporation. All rights reserved.</a></i></p>
</body>
</html>

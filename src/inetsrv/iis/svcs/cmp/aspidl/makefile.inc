#
# Supplemental rules for generating Type library.
#
iCPU=$(PROCESSOR_ARCHITECTURE)
!IF "$(iCPU)"=="x86"
iCPU=I386
!ENDIF

ASPTLB_H        = ..\..\..\inc\$(O)\asptlb.h
CDROOT=$(_NTTREE)\inetsrv

# MkTypeLib Stuff
$(O)\_asptlb.h $(O)\asp.tlb: .\asp.idl
	midl /mktyplib203 /Oicf /out .\$(O) /I $(SDK_INC_PATH) /h _asptlb.h  /tlb asp.tlb asp.idl

$(ASPTLB_H): $(O)\_asptlb.h
	echo // This file was generated by mktyplib.exe, then munged by Active Server Pages build. > $@
	echo // Changes: >> $@
	echo // - we include "dispatch.h" (our standard IDispatch implementation) >> $@
	echo // >> $@
	echo // - we #define "NO_BASEINTERFACE_FUNCS" to prevent pure virtual >> $@
	echo // redefinitions of the four IDispatch members that CDispatch defines. >> $@
	echo // >> $@
	echo // - we change the derivation of the classes from "IDispatch" to "CDispatch" >> $@
	echo // >> $@
	echo #include "dispatch.h" >> $@
	echo #define NO_BASEINTERFACE_FUNCS >> $@
	echo // >> $@
	perl -n -e "s/\: public IDispatch/\: public CDispatch/g;print $_;" $(O)\_asptlb.h >> $@

# MIDL for asptxn object
$(O)\asptxn.h: $(O)\_asptxn.h
	echo // This file was generated by mktyplib.exe, then munged by Active Server Pages build. > $@
	echo // Changes: >> $@
	echo // - we include "dispatch.h" (our standard IDispatch implementation) >> $@
	echo // >> $@
	echo // - we #define "NO_BASEINTERFACE_FUNCS" to prevent pure virtual >> $@
	echo // redefinitions of the four IDispatch members that CDispatch defines. >> $@
	echo // >> $@
	echo // - we change the derivation of the classes from "IDispatch" to "CDispatch" >> $@
	echo // >> $@
	echo #include "dispatch.h" >> $@
	echo #define NO_BASEINTERFACE_FUNCS >> $@
	echo // >> $@
	perl -n -e "s/\: public IDispatch/\: public CDispatch/g;print $_;" $(O)\_asptxn.h >> $@


$(O)\_asptxn.h : .\asptxn.idl
	midl /Oicf /I $(SDK_INC_PATH) /out .\$(O) /h _asptxn.h /tlb asptxn.tlb asptxn.idl 

